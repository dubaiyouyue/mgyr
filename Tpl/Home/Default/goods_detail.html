<include file="Public/head_app"/> 

  <!---------------------------------- container开始 ---------------------------------->
<!--幻灯片-->
    <script type="text/javascript" src="/js/prefixfree.min.js"></script>
    <script type="text/javascript" src="/js/flipsnap.min.js"></script>
	<script>
	var ww=$(window).width();
	//banner
	var w=428;
	var h=300;
	var b=1;
	var newsssheigtg=(ww*b*h)/w;
new_widht_baifenbi_kuandu=1;
var xiaoxunews=ww-(182/360)*ww;
document.write("<style>.index-h-l-wenzi{width:"+xiaoxunews+"px;top: 50%;margin-top: -28rem;}</style>");
</script>
<script type="text/javascript" src="/js/mobile_module.js"></script>
<script type="text/javascript" src="/js/admin_common.js"></script>
  <if condition="$good[strimg]">
    <!--商品图切换-->
  <div class="banner11">
      <div class="container" style="padding-top:2.75rem;">
        <section class="banner">
          <ul>
            <volist name="good[strimg]" id='imgs'>
        			<li><a><img style="height:262px;" src="{$imgs}"></a></li>
        		</volist>
				  </ul>
          <span class="identify" >
            <volist name="good[strimg]" id='imgs'>
              <em ></em>
            </volist>
  		    </span>
        </section>
      </div>
  </div>
   </if>      
<script type="text/javascript">
    $(function(){
        $.WeiPHP.initBanner(true,5000);
        $.WeiPHP.setRandomColor('.random_color');
    })
</script>
<!--幻灯片-->
<!---------------------------------- container结束 ---------------------------------->

  

  
<!--2016.11.29 尺寸--->
<?php
  //dump($kc);
  //获取颜色
  $yanseee=explode('moweilin',$good['kc']);
  //dump($yanseee);
  foreach($yanseee as $ks=>$vs){
    $ysssaaa=explode('lizhenqiu',$vs);
    $yansearr[]=$ysssaaa['0'];
    $yuccmmck=$yuccmmck?$yuccmmck.'-'.$ysssaaa['0'].$ysssaaa['1'].'-'.$ysssaaa['3']:$ysssaaa['0'].$ysssaaa['1'].'-'.$ysssaaa['3'];
  }
  $yansearr=(array_unique($yansearr));
  //dump($yuccmmck);
?>
<script>
cmmmmm='';//选择尺寸
ysssyyy='';//选择颜色
var yuccmmck=new Array(<?php 
	$yuccmmck=explode('-',$yuccmmck);
	foreach($yuccmmck as $kk=>$vv){
		echo '\''.$vv.'\',';
	}
?>0);//库存数组
function yhansss(sthis,keys){
	//点击颜色
	ysssyyy=keys;
  $('.yaes').css("background","");
  $('#yanse_'+keys).css("background","#DFDFDF");
  $('#getys').val(keys);
	ddsmmyy();
}
function yhanssscm(sthis,cm){
    cmmmmm=cm;
    $('.cms').css("background","");
    $('#cm_'+cm).css("background","#DFDFDF");
    $('#getcm').val(cm);
    ddsmmyy();
  }
function ddsmmyy(){
	//修改库存
	if(cmmmmm && ysssyyy){
		var kkuuccc=yuccmmck.indexOf(ysssyyy+cmmmmm);
		if(kkuuccc<0) kkuucccstr=0;
		else kkuucccstr=yuccmmck[(kkuuccc+1)];
		$('#sdfsdkkccc').text(kkuucccstr);
    $('#kucun').val(kkuucccstr);
	}else{
		$('#sdfsdkkccc').text('--');
    $('#kucun').val(0);
	}
}
</script>
<!--end-->







<div class="spxqy">
  <div class="sqxqy-1"><strong>￥{$good.price}</strong></div>
   <div class="sqxqy-2">￥{$good.cprice}</div>

</div>
<div class="sqxqy-3">{$good.description}</div>


<div class="sqxqy-cm">
  <div class="sqxqy-cma"><strong>尺码</strong></div>
  <div class="cc">
   <div onclick="yhanssscm(this,'XS')" id="cm_XS" class="cms cc-3">XS</div>
     <div onclick="yhanssscm(this,'S')" id="cm_S" class="cms cc-2">S</div>
     <div onclick="yhanssscm(this,'M')" id="cm_M" class="cms cc-2">M</div>
  
  </div>
  <div class="cc1">
    <div onclick="yhanssscm(this,'L')" id="cm_L" class="cms cc-3">L</div>
    <div onclick="yhanssscm(this,'XL')" id="cm_XL" class="cms cc-2">XL</div>
    <div onclick="yhanssscm(this,'XXL')" id="cm_XXL" class="cms cc-2">XXL</div>
	 </div>
  <div class="cc1">
    <div onclick="yhanssscm(this,'3XL')" id="cm_3XL" class="cms cc-3">3XL</div>
  </div>

<!--颜色 2016.11.29-->
<div class="sqxqy-cma"><strong>颜色</strong></div>
<style type="text/css">
  .ulcss{width: 100%; height: 1.5rem; float: left; border: 1px solid #CCCCCC; color: #666; text-align: center; line-height: 1.5rem;}
</style>
<div style="float:left;margin:20px 0px 20px 0px; width:100%">
  <ul style="float:left; width:100%">
    <volist name="yansearr" id='vys'>
      <li style="float:left;width:28%; margin:10px 5px 0px 10px;"><a onclick="yhansss(this,'{$vys}');"><div id="yanse_{$vys}" class="yaes ulcss">{$vys}</div></a></li>
    </volist>
  </ul>
</div>
<div class="kucun" style=" margin-left:40px; line-height:25px; margin-top:5px; margin-bottom:25px;">(<span class="kucunliang" style="color:#f40;" id="sdfsdkkccc">--</span>库存)
	   <span class="dhtz" style="display:inline-block; margin-left:15px;"><a href="#" style="color: #666;text-decoration: underline;">到货通知</a></span>
	   
	   <span class="dhtz" style="display:inline-block; margin-left:15px;">购买送积分{$good.jifen}</span>
	   
	   </div>
<!--end-->


     <div class="spxqy-sl">
       <div class="sl">数量：</div>
       <div class="sl-1">
         <a id='jian'><div class="sl-2">-</div></a>
         <div class="sl-3"><input style="width:100%; height:1.1rem;text-align:center" type='text' id='mun'  name='mun' value='1'></div>
         <a><div class="sl-4" id='jia'>+</div></a>
       
       </div>
       
     </div>
      <div class="ppbz">
        <a> <div class="ppbz-1" style="border-right:1px solid #ccc;">销量&nbsp;<span style="color:#f00">{$good.zxl}</span></div></a>
        <a onclick="addshochang({$good.id})" ><div class="ppbz-2" id='mashangmaiwx'  style="border-right:1px solid #ccc;  background:url(/images/wsc.png) no-repeat left;">收藏商品</div></a>
        <a ><div class="ppbz-2 " >送积分&nbsp;<span style="color:#ff4400">{$good.jifen}</span></div></a>
     </div>
     <div class="spxx">
      <a><div id="spxinxiwx" class="spxx-2 cssbzbhwx">商品信息</div></a>
      <a><div id="shbaozhangwx" class="spxx-2 cssbzbqwx">售后保障</div></a>
     </div>

    <style type="text/css">
    .cssbzbhwx{background: #545E6E;color: #FFF;}
    .cssbzbqwx{color: #545E6E;}
    .cssqhwx{display:none;}
    .sqxqy-cma1 p img{width: 100%;}
    </style>
    <div class="spxx-3">
      <p class="spxxnrwx">品牌：{$good.pinpai}</p>
      <p class="spxxnrwx">衣门襟：{$good.yimenjin}</p>
      <p class="spxxnrwx">适用场景：{$good.sycj}</p>
      <p class="spxxnrwx">商品毛重：{$good.spmz}</p>
      <p class="spxxnrwx">图案：{$good.tuan}</p>
      <p class="spxxnrwx">版型：{$good.banxing}</p>
      <p class="spxxnrwx">薄厚：{$good.baohou}</p>
      <p class="spxxnrwx">流行元素：{$good.lxys}</p>
      <p class="spxxnrwx">销量：{$good.zxl}</p>
      <p class="shbzwx cssqhwx">{$good.shbz}</p>
    </div>
    <div class="sqxqy-cma1 spxxnrwx">
     
      <!-- 	<div class="sqxqy-cma"><strong>商品图片</strong></div>
      	<div class="xqy-tu"><img src="images/20_r1_c1.jpg" width="100%" height="" /></div>
        <div class="xqy-tu"><img src="images/20_r3_c1.jpg" width="100%" height="" /></div>
        <div class="xqy-tu"><img src="images/20_r4_c1.jpg" width="100%" height="" /></div>
        <div class="xqy-tu"><img src="images/20_r5_c1.jpg" width="100%" height="" /></div>
        <div class="xqy-tu"><img src="images/20_r6_c1.jpg" width="100%" height="" /></div>
        <div class="xqy-tu"><img src="images/20_r7_c1.jpg" width="100%" height="" /></div>   -->
        {$good.content}                         
    </div>
  <input type="hidden" id="kucun" value="0">
  <input type="hidden" id="getcm" value="">
  <input type="hidden" id="getys" value="">
</div>
  <!----------------------------foom 开始-->
<div class="xqy-db">
    <div class="xqy-db-1">
        <a onclick="jrgwc({$good.id})"><div id="mycart" class="xqy-gwc">加入购物车</div></a>
        <a onclick="buynowwx({$good.id})" id='addshouchangs'><div class="xqy-ligm">立即购买</div></a>
    </div>
</div>
<script type="text/javascript">
  $("#spxinxiwx").click(function(){
    $(this).addClass('cssbzbhwx');
    $(this).removeClass('cssbzbqwx');
    $("#shbaozhangwx").removeClass('cssbzbhwx');
    $(".shbzwx").addClass('cssqhwx');
    $(".spxxnrwx").removeClass('cssqhwx');
  })
  $("#shbaozhangwx").click(function(){
    $(this).addClass('cssbzbhwx');
    $(this).removeClass('cssbzbqwx');
    $("#spxinxiwx").removeClass('cssbzbhwx');
    $(".spxxnrwx").addClass('cssqhwx');
    $(".shbzwx").removeClass('cssqhwx');
  })
	function tishicengjsqiuonclick(textwz,nicheng){
		$('body').tishicengjsqiu({
			textwz:  textwz, //提示层文字 支持html
			tishicbj: '#ff662d', //提示层背景 #ddd
			colors: '#fff', //文字颜色
			iddtt:3, //自动关闭时间秒
			admmint:'flipInX', //显示动画
			//动画属性说明
			admmout:'zoomOut' //隐藏动画
		});
		document.getElementById(nicheng).focus();
	}
	var key=1;
	function jrgwc(good_id){
    var cm=$('#getcm').val();
    var ys=$('#getys').val();
    var gkc=$('#kucun').val();
    var sum=$('#mun').val();
    if(Number(sum)>Number(gkc)){
      sum=gkc;
      $('#mun').val(sum);
    }
    if(!cm){
      tishicengjsqiuonclick('请选择尺码','mycart');return false;
    }
    if(!ys){
      tishicengjsqiuonclick('请选择颜色','mycart');return false;
    }
    if(gkc==0){
      tishicengjsqiuonclick('抱歉，该货物暂时缺货，选择其他看看吧！','mycart');return false;
    }
    if(sum<=0){
       $('#mun').val(1); return false;
    }
		if(key==2){return false;}
			tishicengjsqiuonclick('正在提交，请稍等...','mycart');
		key=2;
		$.ajax({
            type: "POST",
            url: "{:U('addon/MemberCenter/MemberCenter/Cart_add')}",
            data: "good_id=" + good_id +"&get_mun="+ sum +"&ys=" + ys +"&cm="+ cm+"&gkc="+gkc,
            success: function(msg) {
              	if(msg['is']==1){
              		tishicengjsqiuonclick('成功将数量为'+sum+'加入购物车','mycart');
                  key=1;

              	}else if(msg['is']==2||!msg){
                  key=1;
              		tishicengjsqiuonclick('未能加入购物，请稍后重试','mycart');
              	}else if(msg['is']==3){
              		key=1;
              		tishicengjsqiuonclick('您未登录，正前往登录','mycart');
              		setTimeout(function(){
              			window.location.href="/index.php?s=/addon/Login/Login/index.html"
					        },3000)
              	}else if(msg['is']==4){
                  key=1;
                  tishicengjsqiuonclick('抱歉当前库存数量不足,仅剩'+msg['thiskcs']+'件','mycart');
                }

            }
    });
		
	}

	$('#jian').click( function(){
		var sum=$('#mun').val();
		if(sum>1){
			sum--;
			$('#mun').val(sum);
		}
	})
	$('#jia').click( function(){
		var kc=$('#kucun').val();
		var sum=$('#mun').val();
		if(Number(sum)<Number(kc)){
			console.log(kc+"\n"+sum);
      sum=Number(sum)+1;
			$('#mun').val(sum);
		}
	})
	$('#mun').blur(function(){
		var sum=$('#mun').val();
    var kc=$('#kucun').val();
    if(Number(sum)>Number(kc)){
      sum=kc;
      $('#mun').val(sum);
    }
		if((/^(\+|-)?\d+$/.test( sum ))&&sum>0){  
      $('#mun').val(sum);
		}else{
      sum=1;
      $('#mun').val(sum);

    }
	})
  var sc=1;
  function addshochang(get_gid){
    if(sc==2){return false;}
    sc=2;
    if(!get_gid){
        sc=1;
       tishicengjsqiuonclick('该数据非法，无法收藏','mashangmaiwx'); return false;
    }
    $.ajax({
            type: "POST",
            url: "{:U('addon/MemberCenter/MemberCenter/Addcollection')}",
            data: "good_id=" + get_gid,
            success: function(msg) {
                if(msg['addc']==1){
                  sc=1;
                  $("#mashangmaiwx").css("background-image","url(/images/ysc.png)");
                  tishicengjsqiuonclick('已加入收藏','mashangmaiwx');
                }else if(!msg){
                  sc=1;
                  tishicengjsqiuonclick('收藏失败，请稍后重试','mashangmaiwx');
                }else if(msg['addc']==2){
                  sc=1;
                  tishicengjsqiuonclick('您未登录，正前往登录','mashangmaiwx');
                  setTimeout(function(){
                    window.location.href="/index.php?s=/addon/Login/Login/index.html"
                  },3000)
                }else if(msg['addc']==3){
                  sc=1;
                  $("#mashangmaiwx").css("background-image","url(/images/ysc.png)");
                  tishicengjsqiuonclick('您已收藏该商品','mashangmaiwx');
                }
            }
    });
  }
//立即购买
  var mlwx=1;
  function buynowwx(spid){
    var cm=$('#getcm').val();
    var ys=$('#getys').val();
    var sum=$('#mun').val();
    var gkc=$('#kucun').val();
    if(!cm){
      tishicengjsqiuonclick('请选择尺码','getcm');return false;
    }
    if(!ys){
      tishicengjsqiuonclick('请选择颜色','getys');return false;
    }
    if(sum<=0){
       $('#mun').val(1); return false;
    }
    if(gkc==0){
      tishicengjsqiuonclick('抱歉，该货物暂时缺货，选择其他看看吧！','kucun');return false;
    }
    if(mlwx==2){return false;}
      mlwx=2;
    $.ajax({
            type: "POST",
            url: "{:U('addon/MemberCenter/MemberCenter/Buynowwx')}",
            data: "good_id=" + spid+"&get_mun="+ sum +"&ys=" + ys +"&cm="+ cm,
            success: function(msg) {
               if(msg['gm']==1){
                  tishicengjsqiuonclick('订单已提交','addshouchangs');
                  setTimeout(function(){
                    mlwx=1;
                    window.location.href="{:U('addon/MemberCenter/MemberCenter/Cgtjdd')}";
                  },3000)
               }else if(msg['gm']==2||!msg){
                   tishicengjsqiuonclick('订单提交失败，请稍后重试','addshouchangs');
                    mlwx=1;
               }else if(msg['gm']==3){
                    tishicengjsqiuonclick('您未登录，正前往登录','addshouchangs');
                     mlwx=1;
                    setTimeout(function(){
                     window.location.href="/index.php?s=/addon/Login/Login/index.html"
                    },3000)
               }
            }
    });
  }
</script>